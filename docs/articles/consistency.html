<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Parameter consistency checking with interfacer â€¢ interfacer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parameter consistency checking with interfacer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">interfacer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/interfacer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/consistency.html">Parameter consistency checking with interfacer</a></li>
    <li><a class="dropdown-item" href="../articles/devtools.html">Tools to work with `interfacer`</a></li>
    <li><a class="dropdown-item" href="../articles/dispatch.html">Multiple dispatch based on dataframes</a></li>
    <li><a class="dropdown-item" href="../articles/nesting.html">Nested dataframes and `purrr` style list columns</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bristol-vaccine-centre/interfacer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Parameter consistency checking with interfacer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bristol-vaccine-centre/interfacer/blob/HEAD/vignettes/consistency.Rmd" class="external-link"><code>vignettes/consistency.Rmd</code></a></small>
      <div class="d-none name"><code>consistency.Rmd</code></div>
    </div>

    
    
<p>Beyond dataframes as parameters <code>interfacer</code> is also
designed to support R package developers by providing functions for
handling missing parameters, consistency checks, and parametrising per
group analyses.</p>
<p>One area where a lot of boiler plate can be avoided is when a
function can take multiple combinations of optional inputs that resolve
to each other, and where one or more variables can be recycled.</p>
<p>This can require complex logic to handle missing values when some but
not all of the parameters are provided and can have inconsistencies if a
user provides all of the components. Similarly providing lists of
different lengths to such functions can cause issues.</p>
<div class="section level2">
<h2 id="toy-example">Toy example<a class="anchor" aria-label="anchor" href="#toy-example"></a>
</h2>
<p>Suppose we are creating a function that does some mechanics:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">newton2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">m</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># we want to ensure vectorised parameters provided are the same length</span></span>
<span>  <span class="fu"><a href="../reference/recycle.html">recycle</a></span><span class="op">(</span><span class="va">f</span>,<span class="va">m</span>,<span class="va">a</span><span class="op">)</span></span>
<span>  <span class="co"># ensure parameters `f`,`m` and `a` are numeric and coerce them if not.</span></span>
<span>  <span class="fu"><a href="../reference/check_numeric.html">check_numeric</a></span><span class="op">(</span><span class="va">f</span>,<span class="va">m</span>,<span class="va">a</span><span class="op">)</span></span>
<span>  <span class="co"># fill in missing variables using the relationships given.</span></span>
<span>  <span class="fu"><a href="../reference/resolve_missing.html">resolve_missing</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="va">m</span><span class="op">*</span><span class="va">a</span>,</span>
<span>    a <span class="op">=</span> <span class="va">f</span><span class="op">/</span><span class="va">m</span>,</span>
<span>    m <span class="op">=</span> <span class="va">f</span><span class="op">/</span><span class="va">a</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># do something useful here...</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>f<span class="op">=</span><span class="va">f</span>,m<span class="op">=</span><span class="va">m</span>,a<span class="op">=</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Inferring the acceleration, including coercion of <code>f</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="st">"10"</span>,m<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ f <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 10</span></span>
<span><span class="co">#&gt; $ m <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2</span></span>
<span><span class="co">#&gt; $ a <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5</span></span></code></pre></div>
<p>Inferring the acceleration, when recycling the mass parameter:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, m<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 10</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ f <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">#&gt; $ m <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2</span></span>
<span><span class="co">#&gt; $ a <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0</span></span></code></pre></div>
<p>A default value for the mass is given in the function. Inferring it
therefore needs the user to provide an explicit NULL value otherwise the
default prevents inference and the constraints fail as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, a<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : inconsistent inputs detected:</span></span>
<span><span class="co">#&gt; 1) constraint 'f = m * a' is not met.</span></span>
<span><span class="co">#&gt; 2) constraint 'a = f/m' is not met.</span></span>
<span><span class="co">#&gt; 3) constraint 'm = f/a' is not met.</span></span></code></pre></div>
<p>Combining inferring values with specified default values leads to a
slightly counter-intuitive behaviour so this pattern is not recommended.
It is better not to specify both a default value and constraints for
mass.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, m<span class="op">=</span><span class="cn">NULL</span>, a<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 10</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ f <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">#&gt; $ m <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2, 4, 6, 8, 10, 12, 14, 16, 18, 20</span></span>
<span><span class="co">#&gt; $ a <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5</span></span></code></pre></div>
<p>Inferring the force:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>m<span class="op">=</span><span class="fl">2</span>,a<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 10</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ f <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2, 4, 6, 8, 10, 12, 14, 16, 18, 20</span></span>
<span><span class="co">#&gt; $ m <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2</span></span>
<span><span class="co">#&gt; $ a <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span></code></pre></div>
<p>If insufficient information is provided to calculate the remaining
variables an error is thrown:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">newton2</span><span class="op">(</span>m<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : unable to infer missing variable(s): `f`, `a` using:</span></span>
<span><span class="co">#&gt; `f = m * a`</span></span>
<span><span class="co">#&gt; `a = f/m`</span></span>
<span><span class="co">#&gt; `m = f/a`</span></span>
<span><span class="co">#&gt; given known variable(s): `m` in `newton2(m = 2)`</span></span></code></pre></div>
<p>If a default value is given then that is used in the inference if it
is not specified and recycled as needed, but I still think this has the
potential to be confusing:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 10</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ f <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">#&gt; $ m <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5, 5, 5, 5, 5, 5, 5, 5, 5, 5</span></span>
<span><span class="co">#&gt; $ a <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4, 1.6, 1.8, 2.0</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
