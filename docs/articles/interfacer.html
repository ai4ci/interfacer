<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="interfacer">
<title>interfacer • interfacer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="interfacer">
<meta property="og:description" content="interfacer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">interfacer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/interfacer.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>interfacer</h1>
            
      
      
      <div class="d-none name"><code>interfacer.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">interfacer</span></span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">interfacer</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="defining-an-interface">Defining an interface<a class="anchor" aria-label="anchor" href="#defining-an-interface"></a>
</h2>
<p>An interface defines the structure of acceptable dataframes. It is a
list of column names, plus types and some documentation about the
column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_test</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"an integer ID"</span>,</span>
<span>  test <span class="op">=</span> <span class="va">logical</span> <span class="op">~</span> <span class="st">"the test result"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Printing an interface specification shows the structure that the
<code>iface</code> defines.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i_test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A dataframe containing the following columns: </span></span>
<span><span class="co">#&gt; * id (integer) - an integer ID</span></span>
<span><span class="co">#&gt; * test (logical) - the test result</span></span>
<span><span class="co">#&gt; No mandatory groupings.</span></span>
<span><span class="co">#&gt; No default value.</span></span></code></pre></div>
<p>An interface specification is enforced as the default value for a
function. This is a dummy default value but when combined with
<code>ivalidate</code> in the function body a passed parameter can be
validated to ensure the dataframe is of the right shape. We can use
<code>idocument</code> in the Roxygen skeleton to document the dataframe
constraints.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' An example function</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param mydata `r idocument(example_fn, mydata)`</span></span>
<span><span class="co">#' @param another an example   </span></span>
<span><span class="co">#' @param ... not used</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return the conformant dataframe</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">example_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="va">i_test</span>,</span>
<span>  <span class="va">another</span> <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case when we later call <code>example_fn</code> the data is
checked against the requirements by <code>ivalidate</code>, and if
acceptable passed on to the rest of the function body (in this case the
result is returned).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_data</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># this returns the qualifying data</span></span>
<span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="va">example_data</span>, </span>
<span>  <span class="st">"value for another"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ test <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
<p>If we pass non-conformant data <code>ivalidate</code> throws an
informative error about what is wrond with the data. In this case the
<code>test</code> column is missing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_example_data</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    wrong_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># this causes an error as example_data_2$wrong_test is wrongly named</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="va">bad_example_data</span>, </span>
<span>  <span class="st">"value for another"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : missing columns in the `mydata` parameter of example_fn(..).</span></span>
<span><span class="co">#&gt; missing: test</span></span>
<span><span class="co">#&gt; consider renaming / creating missing columns before calling `example_fn`(...)</span></span>
<span><span class="co">#&gt; or by adding `.imap = interfacer::imapper(`test`=...)` to your function call.</span></span></code></pre></div>
<p>We can recover from this error by renaming the columns before passing
<code>bad_example_data</code> to <code>example_fn()</code>.
Alternatively we can use the dynamic dots to pass a mapping to
<code>ivalidate</code> which is applied before the validation. This
parameter is called <code>.imap</code>, and its contents is a
<code><a href="../reference/imapper.html">imapper()</a></code> that holds an set of expressions used for a
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code> call).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="va">bad_example_data</span>, </span>
<span>  <span class="st">"value for another"</span>,</span>
<span>  .imap <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/imapper.html">imapper</a></span><span class="op">(</span>test <span class="op">=</span> <span class="va">wrong_name</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ id         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ wrong_name <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span>
<span><span class="co">#&gt; $ test       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extension-and-composition">Extension and composition<a class="anchor" aria-label="anchor" href="#extension-and-composition"></a>
</h2>
<p>To be useful interface specifications can be composed and extended.
In this case a subtype of the <code>iface</code> specification can be
created:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_test_extn</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  <span class="va">i_test</span>,</span>
<span>  extra <span class="op">=</span> <span class="va">character</span> <span class="op">~</span> <span class="st">"a new value"</span>,</span>
<span>  .groups <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i_test_extn</span><span class="op">)</span></span>
<span><span class="co">#&gt; A dataframe containing the following columns: </span></span>
<span><span class="co">#&gt; * id (integer) - an integer ID</span></span>
<span><span class="co">#&gt; * test (logical) - the test result</span></span>
<span><span class="co">#&gt; * extra (character) - a new value</span></span>
<span><span class="co">#&gt; Ungrouped.</span></span>
<span><span class="co">#&gt; No default value.</span></span></code></pre></div>
<p>and then this extended <code>iface</code> used to constrain the input
of another function by specifying it as the default value. We can also
constrain the output of the function to be conformant to another
specification usng <code>ireturn</code>. Examples of documenting the
input parameter and the output parameter are provided here:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Another example function </span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param mydata `r idocument(example_fn2, mydata)`</span></span>
<span><span class="co">#' @param another an example   </span></span>
<span><span class="co">#' @param ... not used</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return `r i_test`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">example_fn2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">mydata</span> <span class="op">=</span> <span class="va">i_test_extn</span>,</span>
<span>    <span class="va">...</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="va">...</span>, .prune <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="va">mydata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">extra</span><span class="op">)</span></span>
<span>  <span class="co"># check the return value conforms to a new specification</span></span>
<span>  <span class="fu"><a href="../reference/ireturn.html">ireturn</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="va">i_test</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case the <code>ivalidate</code> call prunes unneeded data
from the dataframe, removing any extra columns, and also ensures that
the input is not grouped in any way. Grouping</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grouped_example_data</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span><span class="op">)</span>,</span>
<span>    unneeded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>This is rejected because the grouping is incorrect. An inforative
error message is provided:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn2</span><span class="op">(</span><span class="va">grouped_example_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : unexpected additional groups in `mydata` parameter of example_fn2(...)</span></span>
<span><span class="co">#&gt; additional: id</span></span>
<span><span class="co">#&gt; consider regrouping your data before calling function `example_fn2`, e.g.:</span></span>
<span><span class="co">#&gt; `df %&gt;% ungroup() %&gt;% example_fn2(...)`</span></span>
<span><span class="co">#&gt; or calling function `example_fn2` using a group_modify, e.g.:</span></span>
<span><span class="co">#&gt; `df %&gt;% group_by(id) %&gt;% group_modify(example_fn2, ...)`</span></span></code></pre></div>
<p>Following the instructions in the error message makes this previously
failing data validate against <code>i_test_extn</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grouped_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">example_fn2</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ test <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>The roxygen block of documentation for this second interface is
determined by the <code>#' @param</code> block and the function
<code>idocument</code> which takes a function name and optionally a
parameter name and writes an informative block about the dataframe
expected by the function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/idocument.html">idocument</a></span><span class="op">(</span><span class="va">example_fn2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A dataframe containing the following columns: </span></span>
<span><span class="co">#&gt; - id (integer) - an integer ID</span></span>
<span><span class="co">#&gt; - test (logical) - the test result</span></span>
<span><span class="co">#&gt; - extra (character) - a new value</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ungrouped.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No default value.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="type-coercion">Type coercion<a class="anchor" aria-label="anchor" href="#type-coercion"></a>
</h2>
<p><code>interfacer</code> does not implement a rigid type system, but
rather a permissve one. If the provided data can be coerced to the
specified type without major loss then this is automatically done, as
long as it can proceed with no warnings. In this example <code>id</code>
(an int) is provided as a <code>character</code> and <code>extra</code>
(a character) is coerced from the provided numeric.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">example_fn2</span><span class="op">(</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    extra <span class="op">=</span> <span class="fl">1.1</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ test <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
<p>Completely incorrect data types on the other hans are picked up and
rejected. In this case the data supplied for <code>id</code> cannot be
cast to integer without loss. Similar behaviour is seen if logical data
is anything other than 0 or 1 for example.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1.1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in dplyr::mutate(., `:=`(!!data_col, asfn2(!!data_col))) : </span></span>
<span><span class="co">#&gt;   <span style="color: #00BBBB;">ℹ</span> In argument: `id = asfn2(id)`.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Caused by error:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> input column `id` in function parameter `example_fn(mydata = ?)` cannot be coerced to a integer: not a true integer input</span></span></code></pre></div>
<p>Factors might have allowable levels as well. For this we define them
as an <code>enum</code> which accepts a list of values, which then must
be matched by the levels of a provided factor. The order of the levels
will be taken from the <code>iface</code> spec and relveleving of inputs
is taken to ensure the factor levels match the spec. If
<code>.drop = TRUE</code> is specified then values which don’t match the
levels will be cast to <code>NA</code> rather than causing failure to
allow conformance to a subset of factor values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">is_installed</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">i_diamonds</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span> </span>
<span>    color <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">D</span>,<span class="va">E</span>,<span class="cn">F</span>,<span class="va">G</span>,<span class="va">H</span>,<span class="va">I</span>,<span class="va">J</span>,<span class="va">extra</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the colour"</span>,</span>
<span>    cut <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">Ideal</span>, <span class="va">Premium</span>, .drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the cut"</span>,</span>
<span>    price <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the price"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># itest(ggplot2::diamonds, i_diamonds)</span></span>
<span>  <span class="fu"><a href="../reference/iconvert.html">iconvert</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span>, <span class="va">i_diamonds</span>, .prune <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>   </span>
<span><span class="op">}</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 53,940</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ color <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I, E…</span></span>
<span><span class="co">#&gt; $ cut   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> Ideal, Premium, NA, Premium, NA, NA, NA, NA, NA, NA, NA, Ideal, …</span></span>
<span><span class="co">#&gt; $ price <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 326, 326, 327, 334, 335, 336, 336, 337, 337, 338, 339, 340, 342,…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dispatch">Dispatch<a class="anchor" aria-label="anchor" href="#dispatch"></a>
</h2>
<p>Dispatching to one of a number of functions based on the nature of a
dataframe input is enabled by <code>idispatch(...)</code>. This emulates
the behaviour of <code>S3</code> classes but for dataframes. An example
is the following:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">disp_example</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/idispatch.html">idispatch</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>    disp_example.extn <span class="op">=</span> <span class="va">i_test_extn</span>,</span>
<span>    disp_example.no_extn <span class="op">=</span> <span class="va">i_test</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">disp_example.extn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="va">i_test_extn</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># idispatch has already validated x so we don;t need to here</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"extended data"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">disp_example.no_extn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="va">i_test</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># in this toy example we do the same thing in both possilbilities.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"not extended data"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If we call <code>disp_example()</code> with data that matches the
<code>i_test_extn</code> specification we get one type of behaviour:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmp</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    extra <span class="op">=</span> <span class="fl">1.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">disp_example</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; extended data</span></span>
<span><span class="co">#&gt; [1] "id"    "test"  "extra"</span></span></code></pre></div>
<p>But if we call <code>disp_example()</code> with data that only
matches the <code>i_test</code> specification we get different
behaviour:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this matches the i_test_extn specifciation:</span></span>
<span><span class="va">tmp2</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">disp_example</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; not extended data</span></span>
<span><span class="co">#&gt; [1] "id"   "test"</span></span></code></pre></div>
<div class="section level3">
<h3 id="recursive-dispatch">Recursive dispatch<a class="anchor" aria-label="anchor" href="#recursive-dispatch"></a>
</h3>
<p>In this example we note that the order of the rules is important with
the more detailed being matched first. We can leverage this to create a
recursive functional pattern of dataframe extension that allows multiple
inputs to converge on a single output, this also demonstrates the use of
<code><a href="../reference/itest.html">itest()</a></code> which simply checks an input is of a set type:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_input_1</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the positives"</span>,</span>
<span>  n <span class="op">=</span> <span class="fu">default</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> <span class="op">+</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the total"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_input_2</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  p <span class="op">=</span> <span class="va">proportion</span> <span class="op">~</span> <span class="st">"the proportion"</span>,</span>
<span>  n <span class="op">=</span> <span class="fu">default</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> <span class="op">+</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the total"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_interim</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  <span class="va">i_input_1</span>,</span>
<span>  <span class="va">i_input_2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_final</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  <span class="va">i_interim</span>,</span>
<span>  lower <span class="op">=</span> <span class="va">double</span> <span class="op">~</span> <span class="st">"wilson lower CI"</span>,</span>
<span>  upper <span class="op">=</span> <span class="va">double</span> <span class="op">~</span> <span class="st">"wilson lower CI"</span>,</span>
<span>  mean <span class="op">=</span> <span class="va">double</span> <span class="op">~</span> <span class="st">"wilson mean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_target</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  <span class="va">i_final</span>,</span>
<span>  label <span class="op">=</span> <span class="va">character</span> <span class="op">~</span> <span class="st">"a printable label"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">process.input_1</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="va">i_input_1</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">x</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">process.input_2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="va">i_input_1</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">p</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">process.interim</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">binom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/binom/man/binom.confint.html" class="external-link">binom.wilson</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">process.final</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.1f%% [%1.1f%% - %1.1f%%] (%d/%d)"</span>, </span>
<span>    <span class="va">mean</span><span class="op">*</span><span class="fl">100</span>, <span class="va">lower</span><span class="op">*</span><span class="fl">100</span>, <span class="va">upper</span><span class="op">*</span><span class="fl">100</span>, <span class="va">x</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">process</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># this test must be at the front to prevent infinite recursion</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/itest.html">itest</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">i_target</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="../reference/idispatch.html">idispatch</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>    process.final <span class="op">=</span> <span class="va">i_final</span>,</span>
<span>    process.interim <span class="op">=</span> <span class="va">i_interim</span>,</span>
<span>    process.input_2 <span class="op">=</span> <span class="va">i_input_2</span>,</span>
<span>    process.input_1 <span class="op">=</span> <span class="va">i_input_1</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">process</span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Processing an input of type 1 results in one path through the data
pipeline:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tibble::tibble(x=c(10,30), n=c(NA,50)) %&gt;% itest(i_input_1)</span></span>
<span><span class="fu">process</span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">30</span><span class="op">)</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; $ x      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 10, 30</span></span>
<span><span class="co">#&gt; $ n      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 100, 50</span></span>
<span><span class="co">#&gt; $ p      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1, 0.6</span></span>
<span><span class="co">#&gt; $ method <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "wilson", "wilson"</span></span>
<span><span class="co">#&gt; $ mean   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1, 0.6</span></span>
<span><span class="co">#&gt; $ lower  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.05522914, 0.46181438</span></span>
<span><span class="co">#&gt; $ upper  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1743657, 0.7239161</span></span>
<span><span class="co">#&gt; $ label  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "10.0% [5.5% - 17.4%] (10/100)", "60.0% [46.2% - 72.4%] (30/50)"</span></span></code></pre></div>
<p>Processing an input of type 2, results in a different path through
the data pipeline, but the same outcome:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tibble::tibble(p=0.15,n=1000) %&gt;% itest(i_input_2)</span></span>
<span><span class="fu">process</span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.15</span>,n<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; $ p      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.15</span></span>
<span><span class="co">#&gt; $ n      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1000</span></span>
<span><span class="co">#&gt; $ x      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 150</span></span>
<span><span class="co">#&gt; $ method <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "wilson"</span></span>
<span><span class="co">#&gt; $ mean   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.15</span></span>
<span><span class="co">#&gt; $ lower  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1292101</span></span>
<span><span class="co">#&gt; $ upper  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1734687</span></span>
<span><span class="co">#&gt; $ label  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "15.0% [12.9% - 17.3%] (150/1000)"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="complex-rules-composition">Complex rules &amp; composition<a class="anchor" aria-label="anchor" href="#complex-rules-composition"></a>
</h2>
<p>In the section above we used the pseudo-function
<code>default(100) + integer</code> to specify the input column
<code>x</code>. We also talked about the use of <code>enum(...)</code>
as a rule to match factors. A range of other possible modifiers are
possible such as <code>group_unique</code> or <code>complete</code>
which enforce uniqueness and completeness.</p>
</div>
<div class="section level2">
<h2 id="grouping">Grouping<a class="anchor" aria-label="anchor" href="#grouping"></a>
</h2>
<p>an <code>iface</code> spec can TBD</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_diamonds</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>    carat <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the carat column"</span>,</span>
<span>    cut <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`Fair`</span>,<span class="va">`Good`</span>,<span class="va">`Very Good`</span>,<span class="va">`Premium`</span>,<span class="va">`Ideal`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the cut column"</span>,</span>
<span>    color <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`D`</span>,<span class="va">`E`</span>,<span class="va">`F`</span>,<span class="va">`G`</span>,<span class="va">`H`</span>,<span class="va">`I`</span>,<span class="va">`J`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the color column"</span>,</span>
<span>    clarity <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`I1`</span>,<span class="va">`SI2`</span>,<span class="va">`SI1`</span>,<span class="va">`VS2`</span>,<span class="va">`VS1`</span>,<span class="va">`VVS2`</span>,<span class="va">`VVS1`</span>,<span class="va">`IF`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the clarity column"</span>,</span>
<span>    depth <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the depth column"</span>,</span>
<span>    table <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the table column"</span>,</span>
<span>    price <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the price column"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the x column"</span>,</span>
<span>    y <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the y column"</span>,</span>
<span>    z <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the z column"</span>,</span>
<span>    .groups <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">carat</span> <span class="op">+</span> <span class="va">cut</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># permissive grouping with the `~ . + carat + cut` groups rule</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">color</span>, <span class="va">carat</span>, <span class="va">cut</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/iconvert.html">iconvert</a></span><span class="op">(</span><span class="va">i_diamonds</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 53,940</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; Groups: color, carat, cut [4,803]</span></span>
<span><span class="co">#&gt; $ carat   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.23, 0.21, 0.23, 0.29, 0.31, 0.24, 0.24, 0.26, 0.22, 0.23, 0.…</span></span>
<span><span class="co">#&gt; $ cut     <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> Ideal, Premium, Good, Premium, Good, Very Good, Very Good, Ver…</span></span>
<span><span class="co">#&gt; $ color   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I,…</span></span>
<span><span class="co">#&gt; $ clarity <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> SI2, SI1, VS1, VS2, SI2, VVS2, VVS1, SI1, VS2, VS1, SI1, VS1, …</span></span>
<span><span class="co">#&gt; $ depth   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 61.5, 59.8, 56.9, 62.4, 63.3, 62.8, 62.3, 61.9, 65.1, 59.4, 64…</span></span>
<span><span class="co">#&gt; $ table   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 55, 61, 65, 58, 58, 57, 57, 55, 61, 61, 55, 56, 61, 54, 62, 58…</span></span>
<span><span class="co">#&gt; $ price   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 326, 326, 327, 334, 335, 336, 336, 337, 337, 338, 339, 340, 34…</span></span>
<span><span class="co">#&gt; $ x       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.95, 3.89, 4.05, 4.20, 4.34, 3.94, 3.95, 4.07, 3.87, 4.00, 4.…</span></span>
<span><span class="co">#&gt; $ y       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.98, 3.84, 4.07, 4.23, 4.35, 3.96, 3.98, 4.11, 3.78, 4.05, 4.…</span></span>
<span><span class="co">#&gt; $ z       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.43, 2.31, 2.31, 2.63, 2.75, 2.48, 2.47, 2.53, 2.49, 2.39, 2.…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="default-values">Default values<a class="anchor" aria-label="anchor" href="#default-values"></a>
</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_iris</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>    Sepal.Length <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Sepal.Length column"</span>,</span>
<span>    Sepal.Width <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Sepal.Width column"</span>,</span>
<span>    Petal.Length <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Petal.Length column"</span>,</span>
<span>    Petal.Width <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Petal.Width column"</span>,</span>
<span>    Species <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`setosa`</span>,<span class="va">`versicolor`</span>,<span class="va">`virginica`</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the Species column"</span>,</span>
<span>    .groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .default <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span> <span class="op">=</span> <span class="va">i_iris</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Outputs a zero length data frame</span></span>
<span><span class="fu">test_fn</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 0</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ Sepal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Sepal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Petal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Petal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Species      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="developer-tools">Developer tools<a class="anchor" aria-label="anchor" href="#developer-tools"></a>
</h2>
<p>TBD:</p>
<ul>
<li><code>iclip(diamonds)</code></li>
<li><code>use_dataframe(iris)</code></li>
<li><code>use_iface(diamonds)</code></li>
</ul>
</div>
<div class="section level2">
<h2 id="nesting-list-columns">Nesting &amp; list columns<a class="anchor" aria-label="anchor" href="#nesting-list-columns"></a>
</h2>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_diamonds_cat</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  cut <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`Fair`</span>,<span class="va">`Good`</span>,<span class="va">`Very Good`</span>,<span class="va">`Premium`</span>,<span class="va">`Ideal`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the cut column"</span>,</span>
<span>  color <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`D`</span>,<span class="va">`E`</span>,<span class="va">`F`</span>,<span class="va">`G`</span>,<span class="va">`H`</span>,<span class="va">`I`</span>,<span class="va">`J`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the color column"</span>,</span>
<span>  clarity <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`I1`</span>,<span class="va">`SI2`</span>,<span class="va">`SI1`</span>,<span class="va">`VS2`</span>,<span class="va">`VS1`</span>,<span class="va">`VVS2`</span>,<span class="va">`VVS1`</span>,<span class="va">`IF`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the clarity column"</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">i_diamonds_data</span><span class="op">)</span> <span class="op">~</span> <span class="st">"A nested data column must be specified as a list"</span>,</span>
<span>  .groups <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_diamonds_data</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  carat <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the carat column"</span>,</span>
<span>  depth <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the depth column"</span>,</span>
<span>  table <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the table column"</span>,</span>
<span>  price <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the price column"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the x column"</span>,</span>
<span>  y <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the y column"</span>,</span>
<span>  z <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the z column"</span>,</span>
<span>  .groups <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nested_diamonds</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">cut</span>,<span class="op">-</span><span class="va">color</span>,<span class="op">-</span><span class="va">clarity</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nested_diamonds</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/iconvert.html">iconvert</a></span><span class="op">(</span><span class="va">i_diamonds_cat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 276</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ cut     <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> Ideal, Premium, Good, Premium, Good, Very Good, Very Good, Ver…</span></span>
<span><span class="co">#&gt; $ color   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, I, E, G,…</span></span>
<span><span class="co">#&gt; $ clarity <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> SI2, SI1, VS1, VS2, SI2, VVS2, VVS1, SI1, VS2, VS1, SI1, VS1, …</span></span>
<span><span class="co">#&gt; $ data    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> [&lt;tbl_df[469 x 7]&gt;], [&lt;tbl_df[614 x 7]&gt;], [&lt;tbl_df[89 x 7]&gt;],…</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rob Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
